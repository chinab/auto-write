<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="MEMO">
	<statement id="site.private.list.count" parameterClass="java.util.HashMap" resultClass="java.lang.Long">
		select count(1) from (
			select @RNUM:=0, Q.* from (
				select
					*
				from
					SITE_PRIVATE
				where
					WRITER_SEQ_ID = #USER_SEQ_ID#
				order by
					WRITE_DATETIME desc
			) Q
			where
				1=1
				<isNotNull prepend="and" removeFirstPrepend="true" property="SEARCH_VALUE">
						$SEARCH_KEY$ like concat('%', #SEARCH_VALUE#, '%')
				</isNotNull>
		) R
	</statement>
	
	
	<statement id="site.private.list" parameterClass="java.util.HashMap" resultClass="com.autowrite.common.framework.entity.SiteEntity">
		select @RNUM:=0, Q.* from (
			select
				SEQ_ID, MASTER_SEQ_ID, DOMAIN, SITE_NAME, SITE_ID, SITE_PASSWD, USE_YN, WRITER_SEQ_ID, WRITER_ID, WRITE_DATETIME
			from
				SITE_PRIVATE
			where
				WRITER_SEQ_ID = #USER_SEQ_ID#
			order by
				WRITE_DATETIME desc
		) Q
		where
			1=1
			<isNotNull prepend="and" removeFirstPrepend="true" property="SEARCH_VALUE">
					$SEARCH_KEY$ like concat('%', #SEARCH_VALUE#, '%')
			</isNotNull>
	</statement>
	
	
	<statement id="site.master.list.count" parameterClass="java.util.HashMap" resultClass="java.lang.Long">
		select count(1) from (
			select @RNUM:=0, Q.* from (
				select
					*
				from
					SITE_MASTER
				where
					WRITER_SEQ_ID = #USER_SEQ_ID#
				order by
					WRITE_DATETIME desc
			) Q
			where
				1=1
				<isNotNull prepend="and" removeFirstPrepend="true" property="SEARCH_VALUE">
						$SEARCH_KEY$ like concat('%', #SEARCH_VALUE#, '%')
				</isNotNull>
		) R
	</statement>
	
	
	<statement id="site.master.list" parameterClass="java.util.HashMap" resultClass="com.autowrite.common.framework.entity.SiteEntity">
		select @RNUM:=0, Q.* from (
			select
				SEQ_ID, DOMAIN, SITE_NAME, SITE_ID_KEY, SITE_PASSWD_KEY, 
				LOGIN_URL, WRITE_URL, MODIFY_URL, DELETE_URL, 
				LOGIN_TYPE, WRITE_TYPE, MODIFY_TYPE, DELETE_TYPE, 
				SERVICE_CLASS_NAME, WRITER_SEQ_ID, WRITER_ID, WRITE_DATETIME
			from
				SITE_MASTER
			order by
				WRITE_DATETIME desc
		) Q
		where
			1=1
			<isNotNull prepend="and" removeFirstPrepend="true" property="SEARCH_VALUE">
					$SEARCH_KEY$ like concat('%', #SEARCH_VALUE#, '%')
			</isNotNull>
	</statement>
	
	
	<statement id="site.private.write" parameterClass="java.util.HashMap">
		insert into SITE_PRIVATE (
			MASTER_SEQ_ID, DOMAIN, SITE_NAME, SITE_ID, SITE_PASSWD, USE_YN, WRITER_SEQ_ID, WRITER_ID, WRITE_DATETIME 
		) values (
			#MASTER_SEQ_ID#, 
			(select DOMAIN from SITE_MASTER where SEQ_ID = #MASTER_SEQ_ID#), 
			(select SITE_NAME from SITE_MASTER where SEQ_ID = #MASTER_SEQ_ID#), 
			#SITE_ID#, #SITE_PASSWD#, #USE_YN#, #WRITER_SEQ_ID#, #WRITER_ID#, sysdate()
		)
	</statement>
	
	
	<statement id="site.master.write" parameterClass="java.util.HashMap">
		insert into SITE_MASTER (
			DOMAIN, SITE_NAME, SITE_ID_KEY, SITE_PASSWD_KEY, 
			LOGIN_URL, WRITE_URL, MODIFY_URL, DELETE_URL, 
			LOGIN_TYPE, WRITE_TYPE, MODIFY_TYPE, DELETE_TYPE, 
			SERVICE_CLASS_NAME, SITE_ENCODING, WRITER_SEQ_ID, WRITER_ID, WRITE_DATETIME
		) values (
			#DOMAIN#, #SITE_NAME#, #SITE_ID_KEY#, #SITE_PASSWD_KEY#,
			#LOGIN_URL#, #WRITE_URL#, #MODIFY_URL#, #DELETE_URL#,
			#LOGIN_TYPE#, #WRITE_TYPE#, #MODIFY_TYPE#, #DELETE_TYPE#,
			#SERVICE_CLASS_NAME#, #SITE_ENCODING#, #WRITER_SEQ_ID#, #WRITER_ID#, sysdate()
		)
	</statement>
	
	
	<statement id="site.private.update" parameterClass="java.util.HashMap">
		update
			SITE_PRIVATE
		set
			MASTER_SEQ_ID = #MASTER_SEQ_ID#, 
			DOMAIN = (select DOMAIN from SITE_MASTER where SEQ_ID = #MASTER_SEQ_ID#), 
			SITE_NAME = (select SITE_NAME from SITE_MASTER where SEQ_ID = #MASTER_SEQ_ID#), 
			SITE_ID = (select SITE_ID from SITE_MASTER where SEQ_ID = #MASTER_SEQ_ID#), 
			SITE_ID = #SITE_ID#, 
			SITE_PASSWD = #SITE_PASSWD#, 
			USE_YN = #USE_YN#, 
			WRITER_SEQ_ID = #WRITER_SEQ_ID#, 
			WRITER_ID = #WRITER_ID#
		where
			SEQ_ID = #SEQ_ID#
	</statement>
	
	
	<statement id="site.master.update" parameterClass="java.util.HashMap">
		update
			SITE_MASTER
		set
			DOMAIN = #DOMAIN#, 
			SITE_NAME = #SITE_NAME#, 
			SITE_ID_KEY = #SITE_ID_KEY#, 
			SITE_PASSWD_KEY = #SITE_PASSWD_KEY#, 
			LOGIN_URL = #LOGIN_URL#, 
			WRITE_URL = #WRITE_URL#, 
			MODIFY_URL = #MODIFY_URL#, 
			DELETE_URL = #DELETE_URL#, 
			LOGIN_TYPE = #LOGIN_TYPE#, 
			WRITE_TYPE = #WRITE_TYPE#, 
			MODIFY_TYPE = #MODIFY_TYPE#, 
			DELETE_TYPE = #DELETE_TYPE#, 
			SERVICE_CLASS_NAME = #SERVICE_CLASS_NAME#, 
			SITE_ENCODING = #SITE_ENCODING#, 
			WRITER_SEQ_ID = #WRITER_SEQ_ID#, 
			WRITER_ID = #WRITER_ID#
		where
			SEQ_ID = #SEQ_ID#
	</statement>
	
	
	<statement id="site.private.read" parameterClass="java.util.HashMap" resultClass="com.autowrite.common.framework.entity.SiteEntity">
		select
			SEQ_ID, MASTER_SEQ_ID, DOMAIN, SITE_NAME, SITE_ID, SITE_PASSWD, USE_YN, WRITER_SEQ_ID, WRITER_ID, WRITE_DATETIME 
		from
			SITE_PRIVATE
		where
			SEQ_ID = #SEQ_ID#
	</statement>
	
	
	<statement id="site.master.read" parameterClass="java.util.HashMap" resultClass="com.autowrite.common.framework.entity.SiteEntity">
		select
			SEQ_ID, DOMAIN, SITE_NAME, SITE_ID_KEY, SITE_PASSWD_KEY, 
			LOGIN_URL, WRITE_URL, MODIFY_URL, DELETE_URL, 
			LOGIN_TYPE, WRITE_TYPE, MODIFY_TYPE, DELETE_TYPE, 
			SERVICE_CLASS_NAME, SITE_ENCODING, WRITER_SEQ_ID, WRITER_ID, WRITE_DATETIME
		from
			SITE_MASTER
		where
			SEQ_ID = #SEQ_ID#
	</statement>
	
	
	<statement id="site.private.delete" parameterClass="java.util.HashMap">
		delete from
			SITE_PRIVATE
		where
			SEQ_ID = #SEQ_ID#
	</statement>
	
	
	<statement id="site.master.delete" parameterClass="java.util.HashMap">
		delete from
			SITE_MASTER
		where
			SEQ_ID = #SEQ_ID#
	</statement>
	
	
	<statement id="site.parameter.list" parameterClass="java.util.HashMap" resultClass="com.autowrite.common.framework.entity.SiteParameterEntity">
		select
			SEQ_ID, MASTER_SEQ_ID, MODE, P_KEY, P_VALUE
		from
			SITE_PARAMETER
		where
			MASTER_SEQ_ID = #SITE_MASTER_SEQ_ID#
		order by
			SEQ_ID desc
	</statement>
	
	
	<statement id="contents.private.list.count" parameterClass="java.util.HashMap" resultClass="java.lang.Long">
		select count(1) from (
			select @RNUM:=0, Q.* from (
				select
					*
				from
					CONTENTS_MASTER
				where
					WRITER_SEQ_ID = #USER_SEQ_ID#
				order by
					WRITE_DATETIME desc
			) Q
			where
				1=1
				<isNotNull prepend="and" removeFirstPrepend="true" property="SEARCH_VALUE">
						$SEARCH_KEY$ like concat('%', #SEARCH_VALUE#, '%')
				</isNotNull>
		) R
	</statement>
	
	
	<statement id="contents.private.list" parameterClass="java.util.HashMap" resultClass="com.autowrite.common.framework.entity.BoardEntity">
		select @RNUM:=0, Q.* from (
			select
				SEQ_ID, CONTENTS_NAME, TITLE, CONTENT, WRITER_SEQ_ID, WRITER_ID, WRITE_DATETIME
			from
				CONTENTS_MASTER
			where
				WRITER_SEQ_ID = #USER_SEQ_ID#
			order by
				WRITE_DATETIME desc
		) Q
		where
			1=1
			<isNotNull prepend="and" removeFirstPrepend="true" property="SEARCH_VALUE">
					$SEARCH_KEY$ like concat('%', #SEARCH_VALUE#, '%')
			</isNotNull>
	</statement>
	
	
	<statement id="contents.private.write" parameterClass="java.util.HashMap">
		insert into CONTENTS_MASTER (
			CONTENTS_NAME, TITLE, CONTENT, WRITER_SEQ_ID, WRITER_ID, WRITE_DATETIME 
		) values (
			#CONTENTS_NAME#, #TITLE#, #CONTENT#, #WRITER_SEQ_ID#, #WRITER_ID#, sysdate()
		)
	</statement>
	
	
	<statement id="contents.private.select" parameterClass="java.util.HashMap" resultClass="com.autowrite.common.framework.entity.BoardEntity">
		select
			SEQ_ID, CONTENTS_NAME, TITLE, CONTENT, WRITER_SEQ_ID, WRITER_ID, WRITE_DATETIME
		from
			CONTENTS_MASTER
		where
			SEQ_ID = #SEQ_ID#
	</statement>
	
	
	<statement id="contents.private.delete" parameterClass="java.util.HashMap">
		delete from
			CONTENTS_MASTER
		where
			SEQ_ID = #SEQ_ID#
	</statement>
	
	
	<insert id="autowrite.master.write" parameterClass="java.util.HashMap" >
	    <![CDATA[
	        insert into AUTOWRITE_MASTER (
				CONTENTS_SEQ_ID, TITLE, CONTENT, WRITER_SEQ_ID, WRITER_ID, WRITE_DATETIME
			) values (
				#CONTENTS_SEQ_ID#, #TITLE#, #CONTENT#, #WRITER_SEQ_ID#, #WRITER_ID#, sysdate()
			)
	    ]]>
	    <selectKey keyProperty="seqId" resultClass="Long">
	        SELECT LAST_INSERT_ID()
	    </selectKey>
	</insert>
	
	
	<insert id="autowrite.site.write" parameterClass="java.util.HashMap" >
	    <![CDATA[
	        insert into AUTOWRITE_SITE (
				AUTOWRITE_MASTER_SEQ_ID, SITE_SEQ_ID, SUCCESS_YN, RESPONSE_CONTENT, TRY_COUNT, TRY_DATETIME
			) values (
				#AUTOWRITE_MASTER_SEQ_ID#, #SITE_SEQ_ID#, #SUCCESS_YN#, #RESPONSE_CONTENT#, #TRY_COUNT#, sysdate()
			)
	    ]]>
	    <selectKey keyProperty="seqId" resultClass="Long">
	        SELECT LAST_INSERT_ID()
	    </selectKey>
	</insert>
	
	
	<insert id="autowrite.log.write" parameterClass="java.util.HashMap" >
	    insert into AUTOWRITE_LOG (
			AUTOWRITE_MASTER_SEQ_ID, AUTOWRITE_SITE_SEQ_ID, SITE_SEQ_ID, SUCCESS_YN, RESPONSE_CONTENT, TRY_DATETIME
		) values (
			#AUTOWRITE_MASTER_SEQ_ID#, #AUTOWRITE_SITE_SEQ_ID#, #SITE_SEQ_ID#, #SUCCESS_YN#, #RESPONSE_CONTENT#, sysdate()
		)
	</insert>
	
	
	<statement id="autowrite.master.list.count" parameterClass="java.util.HashMap" resultClass="java.lang.Long">
		select count(1) from (
			select @RNUM:=0, Q.* from (
				select
					*
				from
					AUTOWRITE_MASTER
				where
					WRITER_SEQ_ID = #USER_SEQ_ID#
				order by
					WRITE_DATETIME desc
			) Q
			where
				1=1
				<isNotNull prepend="and" removeFirstPrepend="true" property="SEARCH_VALUE">
						$SEARCH_KEY$ like concat('%', #SEARCH_VALUE#, '%')
				</isNotNull>
		) R
	</statement>
	
	
	<statement id="autowrite.master.list" parameterClass="java.util.HashMap" resultClass="com.autowrite.common.framework.entity.AutowriteEntity">
		select @RNUM:=0, Q.* from (
			select
				SEQ_ID, CONTENTS_SEQ_ID, TITLE, CONTENT, WRITER_SEQ_ID, WRITER_ID, WRITE_DATETIME
				, (select count(1) from AUTOWRITE_SITE where AUTOWRITE_MASTER_SEQ_ID = M.SEQ_ID and SUCCESS_YN = 'Y') SUCCESS_COUNT
				, (select count(1) from AUTOWRITE_SITE where AUTOWRITE_MASTER_SEQ_ID = M.SEQ_ID and SUCCESS_YN = 'N') FAIL_COUNT
			from
				AUTOWRITE_MASTER M
			where
				WRITER_SEQ_ID = #USER_SEQ_ID#
			order by
				WRITE_DATETIME desc
		) Q
		where
			1=1
			<isNotNull prepend="and" removeFirstPrepend="true" property="SEARCH_VALUE">
					$SEARCH_KEY$ like concat('%', #SEARCH_VALUE#, '%')
			</isNotNull>
	</statement>
	
	
	<statement id="autowrite.site.list.count" parameterClass="java.util.HashMap" resultClass="java.lang.Long">
		select count(1) from (
			select @RNUM:=0, Q.* from (
				select
					*
				from
					AUTOWRITE_SITE
				where
					AUTOWRITE_MASTER_SEQ_ID = #AUTOWRITE_MASTER_SEQ_ID#
				order by
					TRY_DATETIME desc
			) Q
			where
				1=1
				<isNotNull prepend="and" removeFirstPrepend="true" property="SEARCH_VALUE">
						$SEARCH_KEY$ like concat('%', #SEARCH_VALUE#, '%')
				</isNotNull>
		) R
	</statement>
	
	
	<statement id="autowrite.site.list" parameterClass="java.util.HashMap" resultClass="com.autowrite.common.framework.entity.AutowriteEntity">
		select @RNUM:=0, Q.* from (
			select
				SEQ_ID, AUTOWRITE_MASTER_SEQ_ID, SITE_SEQ_ID, SUCCESS_YN, RESPONSE_CONTENT, TRY_COUNT, TRY_DATETIME
				, (select SITE_NAME from SITE_PRIVATE where SEQ_ID = S.SITE_SEQ_ID) as SITE_NAME
			from
				AUTOWRITE_SITE S
			where
				AUTOWRITE_MASTER_SEQ_ID = #AUTOWRITE_MASTER_SEQ_ID#
			order by
				TRY_DATETIME desc
		) Q
		where
			1=1
			<isNotNull prepend="and" removeFirstPrepend="true" property="SEARCH_VALUE">
					$SEARCH_KEY$ like concat('%', #SEARCH_VALUE#, '%')
			</isNotNull>
	</statement>
	
	
	<statement id="autowrite.log.list.count" parameterClass="java.util.HashMap" resultClass="java.lang.Long">
		select count(1) from (
			select @RNUM:=0, Q.* from (
				select
					*
				from
					AUTOWRITE_LOG
				where
					AUTOWRITE_MASTER_SEQ_ID = #AUTOWRITE_MASTER_SEQ_ID#
					AND AUTOWRITE_SITE_SEQ_ID = #AUTOWRITE_SITE_SEQ_ID#
				order by
					TRY_DATETIME desc
			) Q
			where
				1=1
				<isNotNull prepend="and" removeFirstPrepend="true" property="SEARCH_VALUE">
						$SEARCH_KEY$ like concat('%', #SEARCH_VALUE#, '%')
				</isNotNull>
		) R
	</statement>
	
	
	<statement id="autowrite.log.list" parameterClass="java.util.HashMap" resultClass="com.autowrite.common.framework.entity.AutowriteEntity">
		select @RNUM:=0, Q.* from (
			select
				SEQ_ID, AUTOWRITE_MASTER_SEQ_ID, AUTOWRITE_SITE_SEQ_ID, SITE_SEQ_ID, SUCCESS_YN, RESPONSE_CONTENT, TRY_DATETIME
				, (select SITE_NAME from SITE_PRIVATE where SEQ_ID = L.SITE_SEQ_ID) as SITE_NAME
			from
				AUTOWRITE_LOG L
			where
				AUTOWRITE_MASTER_SEQ_ID = #AUTOWRITE_MASTER_SEQ_ID#
				AND AUTOWRITE_SITE_SEQ_ID = #AUTOWRITE_SITE_SEQ_ID#
			order by
				TRY_DATETIME desc
		) Q
		where
			1=1
			<isNotNull prepend="and" removeFirstPrepend="true" property="SEARCH_VALUE">
					$SEARCH_KEY$ like concat('%', #SEARCH_VALUE#, '%')
			</isNotNull>
	</statement>
	
	<statement id="autowrite.site.info.read" parameterClass="java.util.HashMap" resultClass="com.autowrite.common.framework.entity.SiteEntity">
		select
			P.SEQ_ID, M.SEQ_ID AS MASTER_SEQ_ID, P.DOMAIN, P.SITE_NAME, P.SITE_ID, P.SITE_PASSWD, P.WRITER_SEQ_ID, P.WRITER_ID, P.WRITE_DATETIME
			, M.LOGIN_URL, M.WRITE_URL, M.MODIFY_URL, M.DELETE_URL
			, M.LOGIN_TYPE, M.WRITE_TYPE, M.MODIFY_TYPE, M.DELETE_TYPE
			, M.SITE_ID_KEY, M.SITE_PASSWD_KEY, M.SERVICE_CLASS_NAME, M.SITE_ENCODING
		from
			SITE_MASTER M, SITE_PRIVATE P
		where
			M.SEQ_ID = P.MASTER_SEQ_ID
			AND P.SEQ_ID = #SITE_SEQ_ID#
	</statement>
		
	<statement id="autowrite.master.delete" parameterClass="java.util.HashMap">
		delete from
			AUTOWRITE_MASTER
		where
			SEQ_ID = #SEQ_ID#
	</statement>
		
	<statement id="autowrite.site.delete" parameterClass="java.util.HashMap">
		delete from
			AUTOWRITE_SITE
		where
			AUTOWRITE_MASTER_SEQ_ID = #SEQ_ID#
	</statement>
		
	<statement id="autowrite.log.delete" parameterClass="java.util.HashMap">
		delete from
			AUTOWRITE_LOG
		where
			AUTOWRITE_MASTER_SEQ_ID = #SEQ_ID#
	</statement>
</sqlMap>